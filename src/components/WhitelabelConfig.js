import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import { useState, useRef } from 'react';
import { useTranslation } from 'react-i18next';
import { useWhitelabel } from '../context/WhitelabelContext';
import { useUserRole } from '../context/UserRoleContext';
import { PhotoIcon, SwatchIcon, GlobeAltIcon, EyeIcon, ArrowPathIcon, CheckCircleIcon, ExclamationTriangleIcon, CogIcon } from '@heroicons/react/24/outline';
const WhitelabelConfig = () => {
    const { t } = useTranslation();
    const { branding, setBranding, isWhitelabelMode, setWhitelabelMode, saveBranding, resetToDefault } = useWhitelabel();
    const { currentRole } = useUserRole();
    const [previewMode, setPreviewMode] = useState(false);
    const [uploadError, setUploadError] = useState('');
    const [isSaving, setIsSaving] = useState(false);
    const fileInputRef = useRef(null);
    // Only admins can access whitelabel config
    if (currentRole !== 'admin') {
        return (_jsx("div", { className: "bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4", children: _jsxs("div", { className: "flex items-center", children: [_jsx(ExclamationTriangleIcon, { className: "w-5 h-5 text-red-600 dark:text-red-400 mr-2" }), _jsx("span", { className: "text-sm font-medium text-red-800 dark:text-red-200", children: t('whitelabel.accessDenied', 'Only system administrators can configure whitelabel settings.') })] }) }));
    }
    const handleLogoUpload = (event) => {
        const file = event.target.files?.[0];
        if (!file)
            return;
        // Validate file type
        if (!file.type.startsWith('image/')) {
            setUploadError(t('whitelabel.errors.invalidFileType', 'Please upload a valid image file (PNG, JPG, SVG).'));
            return;
        }
        // Validate file size (1MB limit)
        if (file.size > 1024 * 1024) {
            setUploadError(t('whitelabel.errors.fileTooLarge', 'File size must be less than 1MB.'));
            return;
        }
        const reader = new FileReader();
        reader.onload = (e) => {
            const dataUrl = e.target?.result;
            setBranding({ logo: dataUrl });
            setUploadError('');
        };
        reader.readAsDataURL(file);
    };
    const handleSave = async () => {
        setIsSaving(true);
        try {
            saveBranding();
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 1000));
        }
        finally {
            setIsSaving(false);
        }
    };
    const currentBranding = isWhitelabelMode ? branding : {
        companyName: 'Peergos Tax',
        primaryColor: '#4F46E5',
        secondaryColor: '#7C3AED',
        footerNote: '© 2025 Peergos Tax - UAE FTA Compliant Tax Management'
    };
    return (_jsxs("div", { className: "space-y-8", children: [_jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { className: "flex items-center space-x-3", children: [_jsx("div", { className: "p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg", children: _jsx(SwatchIcon, { className: "w-6 h-6 text-purple-600 dark:text-purple-400" }) }), _jsxs("div", { children: [_jsx("h2", { className: "text-2xl font-bold text-gray-900 dark:text-white", children: t('whitelabel.title', 'Whitelabel Configuration') }), _jsx("p", { className: "text-gray-600 dark:text-gray-400", children: t('whitelabel.subtitle', 'Customize branding and appearance for your tenant') })] })] }), _jsx("div", { className: "flex items-center space-x-3", children: _jsxs("button", { onClick: () => setPreviewMode(!previewMode), className: `inline-flex items-center px-4 py-2 rounded-lg text-sm font-medium transition-colors ${previewMode
                                ? 'bg-indigo-600 text-white hover:bg-indigo-700'
                                : 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600'}`, children: [_jsx(EyeIcon, { className: "w-4 h-4 mr-2" }), previewMode ? t('common.exitPreview', 'Exit Preview') : t('common.preview', 'Preview')] }) })] }), _jsxs("div", { className: "grid grid-cols-1 lg:grid-cols-2 gap-8", children: [_jsxs("div", { className: "space-y-6", children: [_jsxs("div", { className: "bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6", children: [_jsxs("div", { className: "flex items-center justify-between mb-4", children: [_jsxs("div", { className: "flex items-center space-x-3", children: [_jsx(CogIcon, { className: "w-5 h-5 text-gray-600 dark:text-gray-400" }), _jsx("h3", { className: "text-lg font-semibold text-gray-900 dark:text-white", children: t('whitelabel.mode.title', 'Whitelabel Mode') })] }), _jsxs("label", { className: "relative inline-flex items-center cursor-pointer", children: [_jsx("input", { type: "checkbox", checked: isWhitelabelMode, onChange: (e) => setWhitelabelMode(e.target.checked), className: "sr-only peer" }), _jsx("div", { className: "w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600" })] })] }), _jsx("p", { className: "text-sm text-gray-600 dark:text-gray-400", children: isWhitelabelMode
                                            ? t('whitelabel.mode.enabled', 'Custom branding is active. Your tenant will use the configured branding.')
                                            : t('whitelabel.mode.disabled', 'Using default Peergos branding. Enable to apply custom branding.') })] }), _jsxs("div", { className: "bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6", children: [_jsxs("div", { className: "flex items-center space-x-3 mb-4", children: [_jsx(PhotoIcon, { className: "w-5 h-5 text-gray-600 dark:text-gray-400" }), _jsx("h3", { className: "text-lg font-semibold text-gray-900 dark:text-white", children: t('whitelabel.logo.title', 'Company Logo') })] }), _jsxs("div", { className: "space-y-4", children: [_jsx("input", { ref: fileInputRef, type: "file", accept: "image/*", onChange: handleLogoUpload, className: "hidden" }), _jsxs("div", { className: "flex items-center space-x-4", children: [branding.logo ? (_jsx("div", { className: "w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center overflow-hidden", children: _jsx("img", { src: branding.logo, alt: "Logo preview", className: "w-full h-full object-contain" }) })) : (_jsx("div", { className: "w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center", children: _jsx(PhotoIcon, { className: "w-8 h-8 text-gray-400" }) })), _jsx("button", { onClick: () => fileInputRef.current?.click(), className: "px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors text-sm font-medium", children: branding.logo ? t('whitelabel.logo.change', 'Change Logo') : t('whitelabel.logo.upload', 'Upload Logo') })] }), uploadError && (_jsx("p", { className: "text-sm text-red-600 dark:text-red-400", children: uploadError })), _jsx("p", { className: "text-xs text-gray-600 dark:text-gray-400", children: t('whitelabel.logo.requirements', 'PNG, JPG, or SVG. Maximum 1MB. Recommended size: 200x60px') })] })] }), _jsxs("div", { className: "bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6", children: [_jsx("h3", { className: "text-lg font-semibold text-gray-900 dark:text-white mb-4", children: t('whitelabel.companyName.title', 'Company Name') }), _jsx("input", { type: "text", value: branding.companyName || '', onChange: (e) => setBranding({ companyName: e.target.value }), placeholder: "Your Company Name", className: "w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent" })] }), _jsxs("div", { className: "bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6", children: [_jsx("h3", { className: "text-lg font-semibold text-gray-900 dark:text-white mb-4", children: t('whitelabel.colors.title', 'Color Scheme') }), _jsxs("div", { className: "grid grid-cols-2 gap-4", children: [_jsxs("div", { children: [_jsx("label", { className: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2", children: t('whitelabel.colors.primary', 'Primary Color') }), _jsxs("div", { className: "flex items-center space-x-3", children: [_jsx("input", { type: "color", value: branding.primaryColor || '#4F46E5', onChange: (e) => setBranding({ primaryColor: e.target.value }), className: "w-10 h-10 rounded-lg border border-gray-300 dark:border-gray-600 cursor-pointer" }), _jsx("input", { type: "text", value: branding.primaryColor || '#4F46E5', onChange: (e) => setBranding({ primaryColor: e.target.value }), className: "flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm", placeholder: "#4F46E5" })] })] }), _jsxs("div", { children: [_jsx("label", { className: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2", children: t('whitelabel.colors.secondary', 'Secondary Color') }), _jsxs("div", { className: "flex items-center space-x-3", children: [_jsx("input", { type: "color", value: branding.secondaryColor || '#7C3AED', onChange: (e) => setBranding({ secondaryColor: e.target.value }), className: "w-10 h-10 rounded-lg border border-gray-300 dark:border-gray-600 cursor-pointer" }), _jsx("input", { type: "text", value: branding.secondaryColor || '#7C3AED', onChange: (e) => setBranding({ secondaryColor: e.target.value }), className: "flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white text-sm", placeholder: "#7C3AED" })] })] })] })] }), _jsxs("div", { className: "bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6", children: [_jsx("h3", { className: "text-lg font-semibold text-gray-900 dark:text-white mb-4", children: t('whitelabel.footer.title', 'Custom Footer Note') }), _jsx("textarea", { value: branding.footerNote || '', onChange: (e) => setBranding({ footerNote: e.target.value }), placeholder: "\u00A9 2025 Your Company Name - Custom footer message", rows: 2, className: "w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent" })] }), _jsxs("div", { className: "bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6", children: [_jsxs("div", { className: "flex items-center space-x-3 mb-4", children: [_jsx(GlobeAltIcon, { className: "w-5 h-5 text-gray-600 dark:text-gray-400" }), _jsx("h3", { className: "text-lg font-semibold text-gray-900 dark:text-white", children: t('whitelabel.domain.title', 'Custom Domain') })] }), _jsx("input", { type: "text", value: branding.customDomain || '', onChange: (e) => setBranding({ customDomain: e.target.value }), placeholder: "tax.yourcompany.ae", className: "w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent" }), _jsx("p", { className: "text-xs text-gray-600 dark:text-gray-400 mt-2", children: t('whitelabel.domain.note', 'Note: Custom domain mapping requires backend configuration and DNS setup. This is a placeholder for now.') })] }), _jsxs("div", { className: "flex items-center space-x-4", children: [_jsx("button", { onClick: handleSave, disabled: isSaving, className: "inline-flex items-center px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium", children: isSaving ? (_jsxs(_Fragment, { children: [_jsx(ArrowPathIcon, { className: "w-4 h-4 mr-2 animate-spin" }), t('common.saving', 'Saving...')] })) : (_jsxs(_Fragment, { children: [_jsx(CheckCircleIcon, { className: "w-4 h-4 mr-2" }), t('common.save', 'Save Configuration')] })) }), _jsxs("button", { onClick: resetToDefault, className: "inline-flex items-center px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-medium", children: [_jsx(ArrowPathIcon, { className: "w-4 h-4 mr-2" }), t('common.reset', 'Reset to Default')] })] })] }), _jsxs("div", { className: "space-y-6", children: [_jsxs("div", { className: "bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6", children: [_jsxs("h3", { className: "text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center", children: [_jsx(EyeIcon, { className: "w-5 h-5 mr-2 text-gray-600 dark:text-gray-400" }), t('whitelabel.preview.title', 'Live Preview')] }), _jsx("div", { className: "bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4 mb-4", style: {
                                            borderColor: isWhitelabelMode ? (branding.primaryColor || '#4F46E5') : '#4F46E5',
                                            borderTopWidth: '3px'
                                        }, children: _jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { className: "flex items-center space-x-3", children: [currentBranding.logo ? (_jsx("img", { src: currentBranding.logo, alt: "Logo", className: "h-8 w-auto" })) : (_jsx("div", { className: "w-8 h-8 rounded-lg flex items-center justify-center text-white font-bold text-sm", style: { backgroundColor: currentBranding.primaryColor || '#4F46E5' }, children: currentBranding.companyName?.charAt(0) || 'P' })), _jsx("span", { className: "text-xl font-semibold text-gray-900 dark:text-white", children: currentBranding.companyName || 'Peergos Tax' })] }), _jsxs("div", { className: "flex items-center space-x-2", children: [_jsx("div", { className: "w-3 h-3 rounded-full", style: { backgroundColor: currentBranding.primaryColor || '#4F46E5' } }), _jsx("div", { className: "w-3 h-3 rounded-full", style: { backgroundColor: currentBranding.secondaryColor || '#7C3AED' } })] })] }) }), _jsxs("div", { className: "border border-gray-200 dark:border-gray-700 rounded-lg p-4 mb-4", children: [_jsxs("div", { className: "flex items-center justify-between mb-3", children: [_jsx("h4", { className: "font-medium text-gray-900 dark:text-white", children: t('dashboard.title', 'Tax Dashboard') }), _jsx("button", { className: "px-3 py-1 rounded text-sm font-medium text-white", style: { backgroundColor: currentBranding.primaryColor || '#4F46E5' }, children: t('common.viewDetails', 'View Details') })] }), _jsx("div", { className: "text-sm text-gray-600 dark:text-gray-400", children: t('whitelabel.preview.sampleContent', 'This is how your branded interface will appear to users.') })] }), _jsxs("div", { className: "border-t border-gray-200 dark:border-gray-700 pt-4", children: [_jsx("p", { className: "text-xs text-gray-500 dark:text-gray-400 text-center", children: currentBranding.footerNote || '© 2025 Peergos Tax - UAE FTA Compliant Tax Management' }), currentBranding.customDomain && (_jsxs("p", { className: "text-xs text-gray-400 dark:text-gray-500 text-center mt-1", children: [t('whitelabel.preview.domain', 'Custom Domain'), ": ", currentBranding.customDomain] }))] })] }), _jsx("div", { className: `rounded-lg p-4 ${isWhitelabelMode
                                    ? 'bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800'
                                    : 'bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800'}`, children: _jsxs("div", { className: "flex items-center", children: [isWhitelabelMode ? (_jsx(CheckCircleIcon, { className: "w-5 h-5 text-green-600 dark:text-green-400 mr-2" })) : (_jsx(ExclamationTriangleIcon, { className: "w-5 h-5 text-yellow-600 dark:text-yellow-400 mr-2" })), _jsxs("div", { children: [_jsx("p", { className: `text-sm font-medium ${isWhitelabelMode
                                                        ? 'text-green-800 dark:text-green-200'
                                                        : 'text-yellow-800 dark:text-yellow-200'}`, children: isWhitelabelMode
                                                        ? t('whitelabel.status.active', 'Whitelabel mode is active')
                                                        : t('whitelabel.status.inactive', 'Using default Peergos branding') }), _jsx("p", { className: `text-xs ${isWhitelabelMode
                                                        ? 'text-green-700 dark:text-green-300'
                                                        : 'text-yellow-700 dark:text-yellow-300'}`, children: isWhitelabelMode
                                                        ? t('whitelabel.status.activeDescription', 'Your custom branding is applied across all pages.')
                                                        : t('whitelabel.status.inactiveDescription', 'Enable whitelabel mode to apply your custom branding.') })] })] }) })] })] })] }));
};
export default WhitelabelConfig;
